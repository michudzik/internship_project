<div class="container">
  <br />
  <script>
  $(document).ready(function(){
      $('[data-toggle="tooltip"]').tooltip();   
  });
  </script>

  <% if @ticket.closed? %>
    <div class="ticket-closed-message mb-2 bg-danger text-white">
      <tr>
        <td class="align-text-bottom">
          <h2>
            <p class="text-center">THIS TICKET IS CLOSED</p>
          </h2>
        </td>
      </tr>
    </div>
  <% end %>

  <div class="tickets-display">
    <table class="table table-borderless">
      <thead>
        <tr>
          <td class="align-middle" align="center">Title:</td>
          <td class="align-middle" align="center">User:</td>
          <td class="align-middle" align="center">Created at:</td>
          <td class="align-middle" align="center">Status:</td>
          <td></td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="align-middle" align="center"><%= @ticket.title %></td>
          <td class="align-middle" align="center"><%= @ticket.user.fullname %></td>
          <td class="align-middle" align="center"><%= @ticket.created_at.strftime("%Y.%m.%d %H:%M") %></td>
          <td class="align-middle" align="center"><%= @status %></td>
          <td class="align-middle" align="right">
            <% unless @ticket.closed? %>
              <%= render 'lock_ticket_modal', ticket: @ticket %>
            <% end %>
          </td>
        </tr>
        <tr>
          <td colspan="5">
            <%= word_wrap(sanitize(@ticket.note).gsub("\n", "<br />").html_safe, line_width: 10) %>
          </td>
        </tr>
        <tr>
          <td>
            <% if @ticket.uploads.attached? %>
              <hr />
              <strong>Attachments: </strong> 
              <% @ticket.uploads.each_with_index do |upload, i| %>
                <%= link_to("Document #{i+1}", rails_blob_path(upload, disposition: "attachment")) %>
              <% end %>
            <% end %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="jumbotron p-2 bg-light">
    <b>Comments</b>
    <% cache @ticket.comments do %>
      <% @ticket.comments.each do |comment| %>
        <% cache comment do %>
          <% if comment.user.id == current_user.id %>
            <%= render 'comments/comment', comment: comment, align: 'right' %>
          <% else %>
            <%= render 'comments/comment', comment: comment, align: 'left' %> 
          <% end %>
        <% end %>
      <% end %>
    <% end %>

  <% unless @ticket.closed? %>
    <br />
    <div class="tickets-display">
      <%= render 'comments/form' %>
    </div>
  <% end %>
</div>